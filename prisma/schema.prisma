generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User {
    id       String @id @default(cuid())
    username String
    email    String @unique
    password String
    storage  Int    @default(0)

    folders Folder[]
    files   File[]

    @@map("users")
}

model File {
    id           String  @id @default(cuid())
    userId       String
    folderId     String
    originalName String
    displayName  String

    cloudinaryUrl          String @unique
    cloudinaryPublicId     String
    cloudinaryResourceType String
    mimetype               String
    size                   Int

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    user   User    @relation(fields: [userId], references: [id], onDelete: Cascade)
    folder Folder  @relation(fields: [folderId], references: [id], onDelete: Cascade)

    @@unique([displayName, folderId])
    @@index([displayName])
    @@index([userId, updatedAt(sort: Desc)])
    @@index([folderId, userId, updatedAt(sort: Desc)])
    @@map("files")
}

model Folder {
    id        String   @id @default(cuid())
    name      String
    userId    String
    parentId  String?
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
    parent   Folder?  @relation("FolderHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
    children Folder[] @relation("FolderHierarchy")
    files    File[]

    @@unique([name, parentId])
    @@index([name])
    @@index([userId, updatedAt(sort: Desc)])
    @@index([parentId, userId, updatedAt(sort: Desc)])
    @@map("folders")
}